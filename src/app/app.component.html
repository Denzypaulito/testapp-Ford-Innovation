<div class="vwindow">
  <div class="container">
    <div class="subcontainer">
      <marquee><h1>Bienvenidos a Ford 游뚱</h1></marquee>
      <div class="row row-cols-auto">
        <app-stylized-button class="col" *ngFor="let numero of numeros" [ubicacion_id]="numero" [buttonName]="'Fila ' + numero" action="view" (clickedEvt)="openRackDetail($event);"></app-stylized-button>
      </div>
      <br>
      <div class="centered">
        <button (click)="openCreateReport()" class="btn btn-primary me-2">Registro Manual</button>
        <button (click)="openSearchRack()" class="btn btn-danger me-2">Buscar Rack</button>
        <button (click)="openCheckoutRack()" class="btn btn-success">Dar Salida Rack</button>
      </div>
    </div>  
  </div>
</div>

<p-dialog [header]="'Fila '+openRack" [modal]="true" [(visible)]="rack_detail_visible" [style]="{ width: '35rem' }">
  <table style="width: 100%;">
    <tr>
      <th>Rack</th>
      <th>Ubicaci칩n</th>
      <th>Embarque</th>
      <th>Urgencia</th>
      <th>Motor</th>
    </tr>
    <tr *ngFor="let rep of rack_detail_reports">
      <td>{{rep.rackNumber}}</td>
      <td>{{rep.locationNumber}}</td>
      <td>{{rep.shipmentDate | date}}</td>
      <span [ngClass]="getShipmentClass(rep.shipmentDate)"></span>
      <td><span *ngFor="let motor of rep.engineNumber">{{motor}}<br></span></td>
    </tr>
  </table>
</p-dialog>

<p-dialog header="Crear Registro" [modal]="true" [(visible)]="create_report_visible" [style]="{ width: '25rem' }">
  <form (ngSubmit)="onSubmitReport()" #reportForm="ngForm">
    <div>
      <label class="form-label" for="engineNumber">N칰mero de Motor(es)</label>
      <input class="form-control" type="text" id="engineNumber" [(ngModel)]="report.engineNumber" name="engineNumber" required>
    </div>
    <div>
      <label class="form-label" for="rackNumber">N칰mero de Rack</label>
      <input class="form-control" type="text" id="rackNumber" [(ngModel)]="report.rackNumber" name="rackNumber" required>
    </div>
    <div>
      <label class="form-label" for="locationNumber">N칰mero de Ubicaci칩n</label>
      <input class="form-control" type="text" id="locationNumber" [(ngModel)]="report.locationNumber" name="locationNumber" required>
    </div>
    <div>
      <label class="form-label" for="shipmentDate">Fecha de Embarque</label>
      <p-calendar id="shipmentDate" name="shipmentDate" [(ngModel)]="report.shipmentDate" appendTo="body" />
    </div>
    <button type="button" class="mt-2 btn btn-info me-2" (click)="openPilaSelection()">Seleccionar Pila</button>
    <button type="submit" class="mt-2 btn btn-success" [disabled]="!report.pilaNumber">Crear Registro</button>
  </form>
</p-dialog>

<p-dialog header="Seleccionar N칰mero de Pila" [modal]="true" [(visible)]="pila_selection_visible" [style]="{ width: '20rem' }">
  <div class="list-group">
    <button type="button" class="list-group-item list-group-item-action" *ngFor="let pila of pilas" (click)="selectPila(pila)">
      Pila {{ pila }}
    </button>
  </div>
</p-dialog>

<p-dialog header="Buscar Rack" [modal]="true" [(visible)]="search_rack_visible" [style]="{ width: '50rem' }">
  <div class="row">
    <input class="col form-control" type="text" [(ngModel)]="searchQuery" placeholder="Buscar Rack">
    <button (click)="searchRack()" class="ms-2 col-3 btn btn-primary">Buscar</button>
  </div>
  <div *ngIf="reports.length > 0" class="mt-4">
    <table style="width: 100%;">
      <tr>
        <th>Rack</th>
        <th>Ubicaci칩n</th>
        <th>Embarque</th>
        <th>Urgencia</th>
        <th>Motor</th>
      </tr>
      <tr *ngFor="let rep of reports">
        <td>{{ rep.rackNumber }}</td>
        <td>{{ rep.locationNumber }}</td>
        <td>{{ rep.shipmentDate | date }}</td>
        <td><span [ngClass]="getShipmentClass(rep.shipmentDate)"></span></td>
        <td><span *ngFor="let motor of rep.engineNumber">{{motor}}<br></span></td>
      </tr>
    </table>
  </div>
  <div *ngIf="reports.length === 0 && searchQuery">
    <p>No se encontr칩 ning칰n rack con ese n칰mero.</p>
  </div>  
</p-dialog>

<p-dialog header="Dar Salida Rack" [modal]="true" [(visible)]="checkout_rack_visible" [style]="{ width: '25rem' }">
  <div>
    <label class="form-label">N칰mero de Rack:</label>
    <input class="form-control" type="text" [(ngModel)]="checkoutRackNumber" placeholder="Ingrese n칰mero de rack">
  </div>
  <div>
    <label class="form-label">Ubicaci칩n:</label>
    <select class="form-control" [(ngModel)]="checkoutLocation" (change)="onLocationChange($event)">
      <option value="Dino">Dino</option>
      <option value="Otra Bodega">Otra Bodega</option>
    </select>
  </div>
  <div *ngIf="checkoutLocation === 'Otra Bodega'">
    <label class="form-label">Nombre de la Bodega:</label>
    <input class="form-control" type="text" [(ngModel)]="otherWarehouseName" placeholder="Ingrese nombre de la bodega">
  </div>
  <button type="button" class="mt-2 btn btn-success" (click)="onCheckoutRack()">Dar Salida</button>
</p-dialog>
